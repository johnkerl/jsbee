<!DOCTYPE html>
<html lang="en">

<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
<meta name="description" content="jsbee" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" /> <!-- mobile-friendly -->
<title>jsbee</title>
<link rel="stylesheet" type="text/css" href="./sample.css">
</head>

<body>

<!-- ================================================================ -->
<h1><span class="boxed-text">jsbee</span></h1>

<table>
<tr>
  <td>
    Required letter(s):
  </td>
  <td>
    <textarea placeholder="A" rows=2 cols=3 id="jsbee-required-letters"></textarea>
  </td>
</tr>
<tr>
  <td>
    Other letters:
  </td>
  <td>
    <textarea placeholder="BCDEFG" rows=2 cols=26 id="jsbee-other-letters"></textarea>
  </td>
</tr>
<tr>
  <td>
    Word list:
  </td>
  <td>
    <select id="jsbee-word-list-dropdown">
      <option value="./usual-suspects.txt">Usual suspects</option>
      <option value="./long-list.txt">Long list</option>
    </select>
  </td>
</tr>
<tr>
  <td>
    &nbsp;
  </td>
  <td>
    <button class="maroon" id="jsbee-clear-button"> Clear </button>
  </td>
</tr>
</table>

<p/>
<div>
  <span id="jsbee-output"> </span>
</div>

<!-- ================================================================ -->
<hr/>

<p>
Source: <a href="https://github.com/johnkerl/jsbee">https://github.com/johnkerl/jsbee</a>
</p>

<!-- ================================================================ -->
<script>

  // ================================================================
  // TODO:
  // * Auto-insert focus in required-letters box
  // * Log-levels
  // * Vary min/max word lengths (defaults 4 and Inf)
  // * Improve (relative) font sizes
  // * Start-up self-test
  // ================================================================

  wordListData = null;

  // ----------------------------------------------------------------
  // DATA FETCHING
  function setWordList(url) {
    console.log("URL", url)
    fetch(url).then((response) => response.text().then((text) => wordListData = text.split("\n")));
  }

  // ----------------------------------------------------------------
  // APPLICATION STATE
  verbose = false;
  minMatchLength = 4;
  maxMatchLength = null;
  wordListData = setWordList('./usual-suspects.txt')

  // ----------------------------------------------------------------
  // ELEMENTS
  const requiredLettersElement  = document.getElementById('jsbee-required-letters');
  const otherLettersElement  = document.getElementById('jsbee-other-letters');
  const wordListDropdown = document.getElementById("jsbee-word-list-dropdown");
  const clearButton = document.getElementById('jsbee-clear-button')
  const outputElement = document.getElementById('jsbee-output');

  // ----------------------------------------------------------------
  // EVENT LISTENERS
  requiredLettersElement.addEventListener('input', function(event) {
    maybeLog("REQUIRED-LETTERS INPUT: <<", event.target.value, ">>")
    showMatches()
  });

  otherLettersElement.addEventListener('input', function(event) {
    maybeLog("OTHER-LETTERS INPUT: <<", event.target.value, ">>")
    showMatches()
  });

  clearButton.addEventListener('click', function(event) {
    maybeLog("CLEAR BUTTON WAS CLICKED")
    clearAll()
  });

  wordListDropdown.addEventListener("change", function() {
    url = wordListDropdown.value
    maybeLog("SELECTED WORD LIST: <<", url, ">>");
    setWordList(url)
    showMatches()
  });

  maybeLog("WORD LIST DATA", wordListData)

  // ----------------------------------------------------------------
  // APPLICATION LOGIC

  function showMatches() {
    requiredLetters = requiredLettersElement.value
    otherLetters = otherLettersElement.value

    matches = getMatchesFromWordList(requiredLetters, otherLetters, minMatchLength, maxMatchLength, wordListData)

    maybeLog(matches)

    if (matches.length == 0) {
      outputElement.textContent = "(No matches)"
    } else {
      outputElement.textContent = matches.join(' ')
    }
  }

  function clearAll() {
    requiredLettersElement.value = ""
    otherLettersElement.value = ""
    outputElement.textContent = ""
  }

  function formatLetters(letters) {
    return letters.join(' ').toUpperCase()
  }

  function maybeLog(text, ...args) {
    if (verbose) {
      console.log(text, ...args)
    }
  }

  function getMatchesFromWordList(requiredLetters, optionalLetters, minMatchLength, maxMatchLength, wordList) {
    maybeLog("MATCHER ENTER")
    maybeLog("requiredLetters ", requiredLetters)
    maybeLog("optionalLetters", optionalLetters)
    maybeLog("wordList", wordList)

    requiredLetters = requiredLetters.toLowerCase()
    optionalLetters = optionalLetters.toLowerCase()
    matches = []
    wordList.forEach((word) => {
      maybeLog("WORD <<", word, ">>")
      if (wordMatches(requiredLetters, optionalLetters, minMatchLength, maxMatchLength, word)) {
        maybeLog("MATCH", word)
        matches.push(word)
      }
    })
    return matches
  }

  function wordMatches(requiredLetters, optionalLetters, minMatchLength, maxMatchLength, word) {
    let allLetters = requiredLetters + optionalLetters;
    if (minMatchLength != null && word.length < minMatchLength) {
      maybeLog("-- match out 1: word", word, "with length", word.length, "less than min", minMatchLength)
      return false
    }
    if (maxMatchLength != null && word.length > maxMatchLength) {
      maybeLog("-- match out 2: word", word, "with length", word.length, "more than max", minMatchLength)
      return false
    }
    for (let i = 0; i < requiredLetters.length; i++) {
      requiredLetter = requiredLetters[i]
      if (word.indexOf(requiredLetter) < 0) {
        maybeLog("-- match out 3: word", word, "missing required letter", requiredLetter, "from", requiredLetters)
        return false
      }
    }
    for (let i = 0; i < word.length; i++) {
      let letter = word[i]
      if (allLetters.indexOf(letter) < 0) {
        maybeLog("-- match out 4: word", word, "missing letter", letter, "from", allLetters)
        return false
      }
    }
    maybeLog("-- match:", word)
    return true
  }

</script>
<!-- ================================================================ -->
</body>
</html>
